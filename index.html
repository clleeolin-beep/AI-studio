function handleAuth(response) {
    // 1. 解碼 Google 回傳的 JWT 憑證
    const payload = JSON.parse(atob(response.credential.split('.')[1]));
    const userEmail = payload.email;
    console.log("登入嘗試：", userEmail); // 偵錯用：可在瀏覽器 F12 查看

    // 2. 權限檢查 (請確保您的 Email 在此清單中)
    const allowedEmails = ["cl.lee.olin@gmail.com"]; // 依據您的圖片設定
    const isAllowed = allowedEmails.includes(userEmail);

    if (isAllowed) {
        // 成功登入後的動作
        const authScreen = document.getElementById('auth-screen');
        const firstTab = document.querySelector('.tab');
        
        if (authScreen) authScreen.style.display = 'none';
        
        // 3. 觸發顯示第一個工具 (例如 map.html)
        if (firstTab) {
            switchTool(firstTab, 'map.html');
        }
    } else {
        alert("未經授權的帳號：" + userEmail);
    }
}

function switchTool(el, fileName) {
    // 切換標籤 active 樣式
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    el.classList.add('active');
    
    // 取得 iframe 並更新來源
    const frame = document.getElementById('tool-frame');
    if (frame) {
        // 重要：在 GitHub Pages 中使用相對路徑加載同目錄下的檔案
        frame.src = "./" + fileName; 
        console.log("正在切換工具至：", fileName);
    }
}
