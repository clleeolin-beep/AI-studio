<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æƒ‡é™½ AI å¯¦é©—å®¤ - å·¥å…·å¹³å°</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        :root { --p-blue: #0f172a; --accent: #2563eb; --nav-bg: #ffffff; }
        body { font-family: 'Microsoft JhengHei', sans-serif; margin: 0; background: #f8fafc; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        /* é©—è­‰é®ç½©å±¤ */
        #auth-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--p-blue); z-index: 10000; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; text-align: center; transition: opacity 0.5s; }
        
        /* é ‚éƒ¨æ¨™ç±¤åˆ— */
        nav { background: var(--nav-bg); display: flex; overflow-x: auto; border-bottom: 1px solid #e2e8f0; padding: 8px 5px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        nav::-webkit-scrollbar { display: none; } 
        
        .tab { padding: 10px 18px; cursor: pointer; border-radius: 20px; white-space: nowrap; color: #64748b; font-size: 14px; font-weight: bold; margin: 0 4px; transition: 0.2s; border: 1px solid transparent; }
        .tab.active { background: #eff6ff; color: var(--accent); border: 1px solid #dbeafe; }

        /* å·¥å…·é¡¯ç¤ºå€ */
        #content-area { flex-grow: 1; position: relative; width: 100%; background: #fff; }
        iframe { width: 100%; height: 100%; border: none; }
        
        .error-msg { color: #ef4444; margin-top: 10px; font-size: 14px; display: none; }
    </style>
</head>
<body>

    <div id="auth-screen">
        <h2 style="letter-spacing: 2px;">æƒ‡é™½ AI å¯¦é©—å®¤</h2>
        <p style="opacity: 0.7; font-size: 14px; margin-bottom: 30px;">è¨­è¨ˆAçµ„å…§éƒ¨å¹³å° (éœ€æˆæ¬Šç™»å…¥)</p>
        
        <div id="g_id_onload"
             data-client_id="992099032000-u34bqjlpetm2qma995nksbu2ot0rhk6f.apps.googleusercontent.com"
             data-callback="handleAuth">
        </div>
        <div class="g_id_signin" data-type="standard" data-shape="pill"></div>
        <div id="err-log" class="error-msg">å¸³è™Ÿä¸åœ¨æˆæ¬Šåå–®å…§ï¼Œè«‹è¯ç¹«ç®¡ç†å“¡ã€‚</div>
    </div>

    <nav id="nav-tabs">
        <div class="tab active" onclick="switchTool(this, 'map.html')">ğŸ—ºï¸ 3Dåœ°åœ–</div>
        <div class="tab" onclick="switchTool(this, 'doc.html')">ğŸ“„ å…¬æ–‡åŠ©æ‰‹</div>
        <div class="tab" onclick="switchTool(this, 'calc.html')">ğŸ§® æ›ç®—å™¨</div>
        <div class="tab" onclick="switchTool(this, 'tree.html')">ğŸŒ³ ä¿®æ¨¹å·¥å–®</div>
        <div class="tab" onclick="switchTool(this, 'green.html')">ğŸŒ¿ ç¶ åŒ–å·¥å–®</div>
        <div class="tab" onclick="switchTool(this, 'inspection_tool.html')">ğŸ“‹ æ–½å·¥æŠ½æŸ¥</div>
    </nav>

    <div id="content-area">
        <iframe id="tool-frame" name="tool-frame" src=""></iframe>
    </div>

    <script>
        // --- æ¬Šé™åå–®è¨­å®š ---
        const allowedEmails = [
            "cl.lee.olin@gmail.com",
    "0757troph@gmail.com","Roserain0516@gmail.com","cccrj0929@gmail.com",
    "hank881016@gmail.com","twjackal@gmail.com","lucis.willow@gmail.com",
    "daphnetang111@gmail.com","jangpp7@gmail.com","kenwu880316@gmail.com",
    "g520g7@gmail.com","adad154154@gmail.com","wu.yingu@gmail.com",
    "maoyuanweng19901210@gmail.com","juby90884@gmail.com","paida19595@gmail.com",
    "tsaisujing@gmail.com","b0287751@gmail.com","awencoacc012@gmail.com",
    "a75121723@gmail.com","copic.wang@gmail.com"                     
        ];

// --- ç™»å…¥å›å‚³è™•ç† ---
        function handleAuth(response) {
            try {
                // è§£æ Google å›å‚³çš„è³‡è¨Š (JWT)
                const base64Url = response.credential.split('.')[1];
                const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                const payload = JSON.parse(window.atob(base64));
                
                // ã€é‡é» 1ã€‘å°‡ç™»å…¥è€…çš„ Email è½‰ç‚ºå°å¯«
                const userEmail = payload.email.toLowerCase();

                console.log("å˜—è©¦ç™»å…¥è€…:", userEmail);

                // ã€é‡é» 2ã€‘å°‡åå–®å…§çš„ Email å…¨éƒ¨è½‰ç‚ºå°å¯«å†é€²è¡Œæ¯”å°
                const isAuthorized = allowedEmails.map(e => e.toLowerCase()).includes(userEmail) || 
                                     userEmail.endsWith("@dunyang.com.tw");

                if (isAuthorized) {
                    console.log("é©—è­‰æˆåŠŸï¼Œé€²å…¥ç³»çµ±");
                    const authScreen = document.getElementById('auth-screen');
                    authScreen.style.opacity = '0';
                    setTimeout(() => {
                        authScreen.style.display = 'none';
                        switchTool(document.querySelector('.tab'), 'map.html');
                    }, 500);
                } else {
                    console.error("æˆæ¬Šå¤±æ•—");
                    document.getElementById('err-log').style.display = 'block';
                    document.getElementById('err-log').innerText = "æœªæˆæ¬Šå¸³è™Ÿ: " + userEmail;
                }
            } catch (error) {
                console.error("ç™»å…¥ç¨‹åºç™¼ç”ŸéŒ¯èª¤:", error);
                alert("é©—è­‰ç¨‹åºå‡ºéŒ¯ï¼Œè«‹åˆ·æ–°é é¢é‡è©¦ã€‚");
            }
        }

        // --- åˆ†é åˆ‡æ›åŠŸèƒ½ ---
        function switchTool(el, fileName) {
            if (!el || !fileName) return;

            // 1. æ›´æ–°æ¨™ç±¤æ¨£å¼
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
            
            // 2. æ›´æ–° iframe ç¶²å€ (å¢åŠ  ./ ç¢ºä¿ GitHub ç›¸å°è·¯å¾‘æ­£ç¢º)
            const frame = document.getElementById('tool-frame');
            const targetUrl = "./" + fileName;
            
            console.log("åˆ‡æ›è‡³:", targetUrl);
            frame.src = targetUrl;
        }

        // åµéŒ¯è¼”åŠ©ï¼šå¦‚æœ 5 ç§’å¾Œæ²’åæ‡‰ï¼Œæç¤ºä½¿ç”¨è€…
        window.onload = function() {
            console.log("ç³»çµ±å·²å°±ç·’ï¼Œç­‰å¾… Google SDK è¼‰å…¥...");
        };
    </script>
</body>
</html>









